<!DOCTYPE HTML>
<html lang="en">
<head>
  <%- include('partials/head') %>
</head>
<body>
  <main class="main-wrap">
    <section class="content-main">
      <div class="content-header">
        <h2 class="content-title">Edit Category</h2>
      </div>
      <div class="card">
        <div class="card-body">
          <% if (message) { %>
            <div class="alert alert-<%= message.type %>">
              <%= message.text %>
            </div>
          <% } %>
          <!-- Edit Category Form -->
          <form id="editCategoryForm" enctype="multipart/form-data">
            <div class="mb-4">
              <label class="form-label">Name</label>
              <input type="text" name="name" value="<%= category.name %>" class="form-control">
            </div>
            <div class="mb-4">
              <label class="form-label">Slug</label>
              <input type="text" name="slug" value="<%= category.slug %>" class="form-control">
            </div>
            <div class="mb-4">
              <label class="form-label">Description</label>
              <textarea name="description" class="form-control"><%= category.description %></textarea>
            </div>
            <div class="mb-4">
              <label class="form-label">Image</label>
              <input type="file" name="image" class="form-control">
              <% if (category.image) { %>
                <img src="<%= category.image %>" alt="Category Image" style="width: 100px; height: 100px; object-fit: cover;">
              <% } %>
            </div>
            <div class="d-flex gap-2">
              <button type="button" id="updateCategoryBtn" class="btn btn-primary">Update Category</button>
              <button type="button" class="btn btn-secondary" onclick="window.location.href='/admin/category'">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>
  <%- include('partials/scripts') %>
  <script>
    document.getElementById("updateCategoryBtn").addEventListener("click", async function () {
      Swal.fire({
        title: "Confirm Update",
        text: "Are you sure you want to update this category?",
        icon: "warning",
        showCancelButton: true,
        confirmButtonText: "Yes, update it!",
        cancelButtonText: "Cancel"
      }).then(async (result) => {
        if (result.isConfirmed) {
          const form = document.getElementById("editCategoryForm");
          const formData = new FormData(form);
          try {
            const response = await fetch(`/admin/category/update/<%= category._id %>`, {
              method: "PUT",
              body: formData
            });
            const data = await response.json();
            if (response.ok && data.success) {
              Swal.fire("Success!", data.message, "success").then(() => {
                window.location.href = "/admin/category";
              });
            } else {
              Swal.fire("Error!", data.message || "Failed to update category", "error");
            }
          } catch (error) {
            console.error("Error updating category:", error);
            Swal.fire("Error!", "An error occurred while updating the category.", "error");
          }
        }
      });
    });
  </script>
  
</body>
</html>
