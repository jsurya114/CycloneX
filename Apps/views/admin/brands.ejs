<!DOCTYPE HTML> 
<html lang="en">
    <%- include('partials/head') %>

<body>
    <div class="screen-overlay"></div>
    <aside class="navbar-aside" id="offcanvas_aside">
        <div class="aside-top">
            <a href="" class="brand-wrap">
                <img src="/backend/imgs/logos/cyclonelogo.png" class="logo" alt="CycloneX Dashboard">
            </a>
            <div>
                <button class="btn btn-icon btn-aside-minimize"> <i class="text-muted material-icons md-menu_open"></i> </button>
            </div>
        </div>
        <nav>
            <ul class="menu-aside">
                <li class="menu-item">
                    <a class="menu-link" href="/admin/dashboard"> <i class="icon material-icons md-home"></i>
                        <span class="text">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link " href="/admin/product-list2"> <i class="icon material-icons md-shopping_bag"></i>
                        <span class="text">Products</span>
                    </a>
                </li>
                <li class="menu-item ">
                    <a class="menu-link" href="/admin/addproduct"> <i class="icon material-icons md-add_box"></i>
                        <span class="text">Add product</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a class="menu-link" href="/admin/category">  <i class="icon material-icons md-category"></i>
                        <span class="text">Category</span>
                    </a>
                </li>
                <li class="menu-item active">
                    <a class="menu-link" href="/admin/brands"> <i class="icon material-icons md-stars"></i>
                        <span class="text">Brands</span> </a>
                </li>
            </ul>
            <hr>
            <ul class="menu-aside">
                <li class="menu-item has-submenu">
                    <a class="menu-link" href="page-settings-1.html"> <i class="icon material-icons md-settings"></i>
                        <span class="text">Settings</span>
                    </a>
                </li>
            </ul>
            <br><br>
        </nav>
    </aside>
    <main class="main-wrap">
        <%- include('partials/header') %>
        <section class="content-main">
            <div class="content-header">
                <div>
                    <h2 class="content-title card-title">Brand </h2>
                    <p>Brand and vendor management</p>
                </div>
                <div>
                    <a href="/admin/addbrand" class="btn btn-primary"><i class="text-muted material-icons md-post_add"></i>Add New Brand</a>
                </div>
            </div>
            <div class="card mb-4">
                <header class="card-header">
                  <div class="row gx-3">
                    <div class="col-lg-4 mb-lg-0 mb-15 me-auto">
                      <input type="text" placeholder="Search..." class="form-control">
                    </div>
                  </div>
                </header>
                <div class="card-body">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Logo</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% brands.forEach(brand => { %>
                                <tr class="<%= brand.isBlocked ? 'table-danger' : '' %>">
                                    <td><img height="50" src="<%= brand.image %>" alt="<%= brand.name %>"></td>
                                    <td><%= brand.name %></td>
                                    <td><%= brand.description %></td>
                                    <td>
                                        <span class="badge <%= brand.isBlocked ? 'bg-danger' : 'bg-success' %>">
                                            <%= brand.isBlocked ? 'Blocked' : 'Active' %>
                                        </span>
                                    </td>
                                    <td>
                                        <a href="/admin/editbrand/<%= brand.id %>" class="btn btn-sm btn-info" style="margin-right: 35px;">Edit</a>
                                        <div class="form-check form-switch" style="display: inline-block; transform: scale(1.5);">
                                            <input class="form-check-input toggle-brand" type="checkbox" data-id="<%= brand.id %>" <%= brand.isBlocked ? '' : 'checked' %> style="background-color: green; border-color: green;">
                                        </div>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        <%- include('partials/footer') %>
    </main>
    <%- include('partials/scripts') %>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.querySelectorAll(".toggle-brand").forEach(toggle => {
          toggle.addEventListener("change", async function () {
            const brandId = this.getAttribute("data-id");
            const action = this.checked ? 'unblock' : 'block';
            Swal.fire({
                title: `Are you sure you want to ${action} this brand?`,
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, proceed!"
            }).then(async (result) => {
                if (result.isConfirmed) {
                    try {
                        const response = await fetch(`/admin/deletebrand/${brandId}`, {
                            method: "DELETE"
                        });
                        const data = await response.json();
                        if (response.ok && data.success) {
                            Swal.fire("Success!", `Brand ${action}ed successfully`, "success").then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire("Error!", data.message, "error");
                        }
                    } catch (error) {
                        Swal.fire("Error!", "An error occurred. Please try again.", "error");
                    }
                } else {
                    this.checked = !this.checked;
                }
            });
          });
        });
    </script>
</body>
</html>
